<div class="message">
  This archive is about how to use Flex and Bison (Yacc) to parse config files that is self-defined. 
</div>
<p>The contens is shown below:<br />
<!-- more --></p>

<ul>
  <li><a href="#description-file-design">Description File Design</a>
    <ul>
      <li><a href="#key-values">Key-Values</a></li>
      <li><a href="#inheritance-mechanism">Inheritance Mechanism</a></li>
      <li><a href="#induction-mechanism">Induction Mechanism</a></li>
      <li><a href="#comments">Comments</a></li>
    </ul>
  </li>
  <li><a href="#syntax-design">Syntax Design</a></li>
  <li><a href="#usage">Usage</a></li>
</ul>

<h2 id="description-file-design">Description File Design</h2>

<h3 id="key-values">Key-Values</h3>

<blockquote>
  <p>Format of the config file is similar to JSON, which is composed of pairs of key-values. The config file is also composed of some tuples, which contain some pairs of key-values. e.g.</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">section</span> <span class="p">{</span>
 <span class="nx">key1</span> <span class="o">=</span> <span class="s2">"string"</span><span class="p">;</span>
 <span class="nx">key2</span> <span class="o">=</span> <span class="mf">12.34</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<blockquote>
  <p>Therefore,</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">section</span><span class="p">.</span><span class="nx">key1</span><span class="o">=</span> <span class="s2">"string"</span>
<span class="nx">section</span><span class="p">.</span><span class="nx">key2</span><span class="o">=</span><span class="mf">12.34</span></code></pre></figure>

<h3 id="inheritance-mechanism">Inheritance Mechanism</h3>

<blockquote>
  <p>Besides the features above, the config file also supports inheritance mechanism. The symbol of inheritance is shown by “:”, e.g.<br /></p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">derived_section</span> <span class="p">:</span> <span class="nx">section</span> <span class="p">{</span>
  <span class="nx">key1</span> <span class="o">=</span> <span class="s2">"override string"</span><span class="p">;</span>
  <span class="nx">key3</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<blockquote>
  <p>Therefore,</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">derived_section</span><span class="p">.</span><span class="nx">key1</span><span class="o">=</span><span class="s2">"override string"</span>
<span class="nx">derived_section</span><span class="p">.</span><span class="nx">key2</span><span class="o">=</span><span class="mf">12.34</span>
<span class="nx">derived_section</span><span class="p">.</span><span class="nx">key3</span><span class="o">=</span><span class="mi">10</span></code></pre></figure>

<blockquote>
  <p>The types of the config file include int, float, string.<br /></p>
</blockquote>

<h3 id="induction-mechanism">Induction Mechanism</h3>

<blockquote>
  <p>The config file also introduces induction mechanism, which is expressed by “include”, e.g.<br />
The contents of a.config:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">section_a</span> <span class="p">{</span>
 <span class="nx">key1</span> <span class="o">=</span> <span class="s2">"string"</span><span class="p">;</span>
 <span class="nx">key2</span> <span class="o">=</span> <span class="mf">12.34</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<blockquote>
  <p>The contents of b.config:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">#</span><span class="nx">include</span> <span class="s2">"path/a.config"</span>
<span class="nx">section_b</span> <span class="p">{</span>
 <span class="nx">key1</span> <span class="o">=</span> <span class="s2">"str1"</span><span class="p">;</span>
 <span class="nx">key2</span> <span class="o">=</span> <span class="mf">12.34</span><span class="p">;</span>
<span class="nx">x</span><span class="p">{</span>
 <span class="nx">key1</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
 <span class="nx">key2</span><span class="o">=</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>
<span class="nl">y</span> <span class="p">:</span> <span class="nx">section_b</span><span class="p">.</span><span class="nx">x</span><span class="p">{</span>
 <span class="nx">key1</span><span class="o">=</span><span class="mi">20</span><span class="p">;</span>
 <span class="nx">key3</span><span class="o">=</span><span class="mi">33</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="nl">z</span><span class="p">:</span><span class="nx">section_a</span><span class="p">{</span>
<span class="nx">key1</span><span class="o">=</span><span class="s2">"str"</span><span class="p">;</span>
<span class="nx">key2</span><span class="o">=</span><span class="mi">25</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<h3 id="comments">Comments</h3>

<blockquote>
  <p>The config file also supports comments, formularized by /<em>comments</em>/ or //, e.g.<br /></p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">//comment</span>
<span class="nx">section</span> <span class="p">{</span>
 <span class="nx">key1</span> <span class="o">=</span> <span class="cm">/* comment*/</span> <span class="s2">"string"</span><span class="p">;</span>
 <span class="nx">key2</span> <span class="o">=</span> <span class="mf">12.34</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<h2 id="syntax-design">Syntax Design</h2>

<blockquote>
  <p>To parse the config file, flex &amp; bison is of much efficiency. Before using the mature tools, we have to define the grammar in advance, which is formularized by Backus-Naur Form. The config files’ Backus-Naur Form is shown below:<br /></p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tuples::= tuple tuples | \epsilon
tuples::= ID LB entries RB | ID COLON LB entries RB
entries::= kv entries | tuple entries | \epsilon
kv::= ID EQ value END
value::= FLOAT | INT | ctring | NULLV
cstring::= STRING cstring

INT-&gt;[0-9]+
FLOAT-&gt;[+-]?[0-9]+(\.[0-9]*)?
STRING-&gt;\"(\\.|[^\\"])*\"
ID-&gt;[a-z_][a-z0-9_\.]*
LB-&gt;{
RB-&gt;}
COLON-&gt;:
EQ-&gt;=
END-&gt;;
NULLV-&gt;NULL
</code></pre></div></div>

<h2 id="usage">Usage</h2>

<blockquote>
  <p>To Compile the source code, you need to install git &amp; make. You can use the following command line to complie them:</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span> <span class="nx">git</span> <span class="nx">clone</span> <span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/lijiansong/ConfigFileParser</span>
<span class="nx">$</span> <span class="nx">cd</span> <span class="nx">ConfigFileParser</span>
<span class="nx">$</span> <span class="nx">make</span></code></pre></figure>

<blockquote>
  <p>After the above cmds, you would get an executable file, named <em>config_parser</em>, and a static library suffixed by <em>.a</em>, named <em>lib_cfg_parser.a</em>. You can execute it like this( before use it you need to write a config file that is formulized by the grammar defined above ):</p>
</blockquote>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span> <span class="p">.</span><span class="o">/</span><span class="nx">config_parser</span> <span class="nx">test</span><span class="p">.</span><span class="nx">config</span></code></pre></figure>

<blockquote>
  <p>You can also call the static library <em>lib_cfg_parser.a</em> in your own program.<br /><a href="https://github.com/lijiansong/ConfigFileParser">To learn more…</a></p>
</blockquote>

<hr />

<p>Want to see something else added? <a href="https://github.com/lijiansong/ConfigFileParser/issues">Open an issue.</a></p>
